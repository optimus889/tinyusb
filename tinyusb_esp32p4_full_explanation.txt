
TinyUSB ESP32P4 示例项目说明文档
==================================

本项目为 TinyUSB 增加 ESP32P4 芯片支持，内容包括应用入口、USB 描述符、板级初始化、设备控制器驱动存根、构建配置等，现说明如下：

------------------------------------------------------------
1. main.c：应用入口
------------------------------------------------------------
- 初始化板级硬件（调用 board_init）
- 初始化 TinyUSB 设备栈（调用 tusb_init）
- 在主循环中轮询 tud_task() 处理 USB 事件
- 当检测到主机通过 CDC 接口发送数据时，读取数据后原样回写，实现虚拟串口回环功能

------------------------------------------------------------
2. usb_descriptors.c：USB 描述符定义
------------------------------------------------------------
- 定义设备描述符，指定 USB 版本、设备类别、供应商 ID（VID）、产品 ID（PID）等信息
- 使用 TinyUSB 宏定义 CDC 接口所需的配置描述符
- 实现 tud_descriptor_device_cb() 返回设备描述符
- 可扩展为包含字符串描述符、配置描述符等标准回调接口

------------------------------------------------------------
3. board_init.c：板级初始化
------------------------------------------------------------
- 启用 ESP32P4 的 USB 外设时钟（调用 periph_module_enable）
- 配置板载 LED 引脚，用于运行状态指示
- 可选配置 USB D+/D- 引脚（ESP32P4 内置 USB PHY，默认固定引脚）
- 可实现 board_led_write() 辅助函数供其他模块调用

------------------------------------------------------------
4. dcd_esp32p4.c：设备控制器驱动存根
------------------------------------------------------------
- 实现 TinyUSB 要求的 DCD 接口函数，包括：
    - dcd_init：初始化 USB 控制器
    - dcd_int_enable / dcd_int_disable：使能/屏蔽中断
    - dcd_int_handler：中断服务函数（可调用 dcd_event_bus_signal 等通知事件）
    - dcd_connect / dcd_disconnect：控制 USB 上拉
    - dcd_set_address：设置设备地址（SETUP 阶段后）
    - dcd_edpt_open / xfer / stall / clear_stall：端点相关操作（此处为模拟实现）
- 当前实现为 stub（存根），不执行真实 USB 操作，但结构完整，可编译通过

------------------------------------------------------------
5. dcd_esp32p4.h：驱动头文件
------------------------------------------------------------
- 声明 dcd_esp32p4.c 中使用的函数接口
- 可包含 ESP32P4 USB 控制器寄存器宏定义（目前为空）
- 确保 TinyUSB 在编译链接时能识别 MCU 驱动模块

------------------------------------------------------------
6. CMakeLists.txt：构建配置文件
------------------------------------------------------------
- 添加 TinyUSB 源码所在目录，并启用其子目录构建
- 列出本示例的源文件：main.c、usb_descriptors.c、board_init.c、dcd_esp32p4.c
- 设置 include 搜索路径，确保能找到头文件
- 添加宏定义 CFG_TUSB_MCU=OPT_MCU_ESP32P4 使 TinyUSB 编译时选择本驱动
- 构建可执行文件，并链接 TinyUSB 提供的 tinyusb_device 库

------------------------------------------------------------
7. platformio.ini：PlatformIO 项目配置（可选）
------------------------------------------------------------
- 使用 platform = espressif32 指定平台为 ESP32 系列
- 选择 board = esp32-p4-evboard 表示目标开发板
- framework = espidf 启用 Espressif 官方 SDK
- 添加构建宏定义，启用 ESP32P4 支持与 CDC 类接口
- 支持通过 USB CDC 虚拟串口与主机通信

------------------------------------------------------------
总结：
本项目构建了一个完整的 ESP32P4 TinyUSB 示例模块，具备规范的文件结构、可编译性与可扩展性，适合作为开源贡献提交。虽目前为 stub 驱动，仍体现了 TinyUSB 移植与嵌入式 USB 协议栈接入的全过程。
